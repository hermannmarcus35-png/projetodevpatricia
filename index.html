<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PROJETO DEV PATRICIA</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #4CAF50; color: white; padding: 1rem; text-align: center; font-size: 20px; font-weight: bold; }
    .container { padding: 1rem; }
    .card { border: 1px solid #ddd; padding: 1rem; margin: 1rem 0; border-radius: 8px; }
    .progress { width: 100%; background: #eee; height: 10px; border-radius: 5px; margin-top: 5px; }
    .progress-bar { height: 10px; background: #4CAF50; width: 0%; border-radius: 5px; }
    button { padding: 10px; margin-top: 10px; border: none; background: #4CAF50; color: white; border-radius: 5px; cursor: pointer; }
    button:hover { background: #45a049; }
    video { width: 100%; margin-top: 10px; }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
</head>
<body>
  <header>PROJETO DEV PATRICIA</header>
  <div class="container" id="app"></div>

  <script>
    // üîë CONFIGURA√á√ÉO DO FIREBASE (substitua com suas credenciais!)
    const firebaseConfig = {
  apiKey: "AIzaSyBd6RMDzj7Chac9Uo_sbGxtSGuYC-BXF0k",
  authDomain: "projetodevpatricia.firebaseapp.com",
  projectId: "projetodevpatricia",
  storageBucket: "projetodevpatricia.firebasestorage.app",
  messagingSenderId: "886851209099",
  appId: "1:886851209099:web:14d713646ed59ffb32518e",
  measurementId: "G-1BZZSR67XP"
    };

    // Inicializa Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    const appDiv = document.getElementById("app");

    let senhaCorreta = false;

    // üîê Login Persistente
    if(localStorage.getItem("logado") === "true") {
      senhaCorreta = true;
      mostrarCursos();
    } else {
      mostrarLogin();
    }

    function mostrarLogin() {
      appDiv.innerHTML = `
        <h2>Login</h2>
        <input type="password" id="senha" placeholder="Digite a senha">
        <button onclick="fazerLogin()">Entrar</button>
      `;
    }

    function fazerLogin() {
      const senha = document.getElementById("senha").value;
      if(senha === "LOVE") {
        localStorage.setItem("logado", "true");
        senhaCorreta = true;
        mostrarCursos();
      } else {
        alert("Senha incorreta!");
      }
    }

    // üìö Mostrar Cursos
    function mostrarCursos() {
      appDiv.innerHTML = `
        <h2>Cursos Dispon√≠veis</h2>
        <div id="cursos"></div>
        <button onclick="formAdicionarCurso()">Adicionar Curso</button>
      `;

      const cursosDiv = document.getElementById("cursos");

      db.collection("cursos").onSnapshot(snapshot => {
        cursosDiv.innerHTML = "";
        snapshot.forEach(doc => {
          const curso = doc.data();
          cursosDiv.innerHTML += `
            <div class="card">
              <h3>${curso.titulo}</h3>
              ${curso.imagem ? `<img src="${curso.imagem}" style="width:100%;max-height:150px;object-fit:cover;">` : ""}
              <div class="progress"><div class="progress-bar" style="width:${curso.progresso||0}%"></div></div>
              <button onclick="abrirCurso('${doc.id}')">Abrir Curso</button>
            </div>
          `;
        });
      });
    }

    // ‚ûï Adicionar Curso
    function formAdicionarCurso() {
      appDiv.innerHTML = `
        <h2>Novo Curso</h2>
        <input id="tituloCurso" placeholder="T√≠tulo do curso"><br>
        <input type="file" id="imgCurso"><br>
        <button onclick="salvarCurso()">Salvar Curso</button>
        <button onclick="mostrarCursos()">Cancelar</button>
      `;
    }

    async function salvarCurso() {
      const titulo = document.getElementById("tituloCurso").value;
      const arquivo = document.getElementById("imgCurso").files[0];

      let urlImg = "";
      if(arquivo) {
        const ref = storage.ref("imagens/" + arquivo.name);
        await ref.put(arquivo);
        urlImg = await ref.getDownloadURL();
      }

      await db.collection("cursos").add({
        titulo: titulo,
        imagem: urlImg,
        progresso: 0
      });

      mostrarCursos();
    }

    // üé• Abrir Curso
    function abrirCurso(id) {
      db.collection("cursos").doc(id).get().then(doc => {
        const curso = doc.data();
        appDiv.innerHTML = `
          <h2>${curso.titulo}</h2>
          <div id="aulas"></div>
          <button onclick="formAdicionarAula('${id}')">Adicionar Aula</button>
          <button onclick="mostrarCursos()">Voltar</button>
          <button style="background:red" onclick="excluirCurso('${id}')">Excluir Curso</button>
        `;

        const aulasDiv = document.getElementById("aulas");

        db.collection("cursos").doc(id).collection("aulas").onSnapshot(snapshot => {
          aulasDiv.innerHTML = "";
          let total = 0, assistidas = 0;

          snapshot.forEach(docAula => {
            const aula = docAula.data();
            total++;
            aulasDiv.innerHTML += `
              <div class="card">
                <h4>${aula.titulo}</h4>
                ${aula.descricao ? `<p>${aula.descricao}</p>` : ""}
                <video controls src="${aula.video}"></video>
                <button onclick="concluirAula('${id}','${docAula.id}')">Concluir Aula</button>
              </div>
            `;
            if(aula.concluida) assistidas++;
          });

          // Atualizar progresso
          let progresso = total > 0 ? (assistidas/total)*100 : 0;
          db.collection("cursos").doc(id).update({progresso: progresso});
        });
      });
    }

    // üóëÔ∏è Excluir Curso com senha DELETE
    async function excluirCurso(idCurso) {
      const senha = prompt("Digite a senha para excluir este curso:");
      if (senha !== "DELETE") {
        alert("Senha incorreta. O curso n√£o ser√° exclu√≠do.");
        return;
      }

      // Apagar todas as aulas do curso
      const aulasSnap = await db.collection("cursos").doc(idCurso).collection("aulas").get();
      const batch = db.batch();
      aulasSnap.forEach(doc => batch.delete(doc.ref));
      await batch.commit();

      // Apagar o curso
      await db.collection("cursos").doc(idCurso).delete();

      alert("Curso exclu√≠do com sucesso!");
      mostrarCursos();
    }

    // ‚ûï Adicionar Aula
    function formAdicionarAula(idCurso) {
      appDiv.innerHTML = `
        <h2>Nova Aula</h2>
        <input id="tituloAula" placeholder="T√≠tulo da aula"><br>
        <textarea id="descricaoAula" placeholder="Descri√ß√£o"></textarea><br>
        <input type="file" id="videoAula"><br>
        <button onclick="salvarAula('${idCurso}')">Salvar Aula</button>
        <button onclick="abrirCurso('${idCurso}')">Cancelar</button>
      `;
    }

    async function salvarAula(idCurso) {
      const titulo = document.getElementById("tituloAula").value;
      const descricao = document.getElementById("descricaoAula").value;
      const arquivo = document.getElementById("videoAula").files[0];

      let urlVideo = "";
      if(arquivo) {
        const ref = storage.ref("videos/" + arquivo.name);
        await ref.put(arquivo);
        urlVideo = await ref.getDownloadURL();
      }

      await db.collection("cursos").doc(idCurso).collection("aulas").add({
        titulo: titulo,
        descricao: descricao,
        video: urlVideo,
        concluida: false
      });

      abrirCurso(idCurso);
    }

    // ‚úîÔ∏è Concluir Aula
    function concluirAula(idCurso, idAula) {
      db.collection("cursos").doc(idCurso).collection("aulas").doc(idAula).update({
        concluida: true
      });
    }
  </script>
</body>
</html>
